<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AR Poster Futuristik</title>
  <style>
    body,html{margin:0;height:100%;overflow:hidden;font-family:Inter,Arial}
    #container{position:fixed;inset:0;background:#000}
    #ar-button{
      position:fixed;left:50%;transform:translateX(-50%);bottom:20px;
      padding:12px 18px;border-radius:10px;background:#00d1ff;color:#fff;
      border:none;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,0.3);
    }
    #exitBtn{
      position:fixed;right:12px;bottom:20px;padding:8px 12px;
      border-radius:8px;background:#fff;border:none;display:none
    }
    #hint{
      position:fixed;top:12px;left:12px;color:#fff;
      background:rgba(0,0,0,0.6);padding:6px 10px;border-radius:8px;font-size:14px
    }
    #popup{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.65);
      backdrop-filter:blur(12px) saturate(150%);
      z-index:20;
      animation:fadeIn 0.6s ease;
    }
    #popup img{
      max-width:80%;max-height:80%;
      border-radius:20px;
      box-shadow:0 0 25px #00eaff,0 0 50px #00eaff;
      position:relative;
      animation:scaleIn 0.5s ease;
    }
    /* hologram shimmer overlay */
    #popup img::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(transparent 40%, rgba(0,255,255,0.25) 50%, transparent 60%);
      animation:scanline 2s linear infinite;
      border-radius:20px;
    }
    @keyframes fadeIn{from{opacity:0;} to{opacity:1;}}
    @keyframes scaleIn{from{transform:scale(0.7);opacity:0;} to{transform:scale(1);opacity:1;}}
    @keyframes scanline{0%{background-position:0 -100%;}100%{background-position:0 200%;}}
  </style>
</head>
<body>
  <div id="container"></div>
  <div id="hint">Ketuk layar untuk menempatkan poster futuristik.</div>
  <button id="ar-button">Enter AR</button>
  <button id="exitBtn">Exit AR</button>
  <div id="popup"><img id="popupImg" src="" alt="preview"/></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script>
    // ----- Data (gambar popup dummy futuristik) -----
    const infos = [
      {title:'Kota Terapung', img:'https://picsum.photos/600/800?random=1'},
      {title:'Transportasi Holografik', img:'https://picsum.photos/600/800?random=2'},
      {title:'Antarmuka Otak-Komputer', img:'https://picsum.photos/600/800?random=3'},
      {title:'Energi Fusi Mini', img:'https://picsum.photos/600/800?random=4'},
      {title:'AI Kesehatan Pribadi', img:'https://picsum.photos/600/800?random=5'}
    ];

    // ----- WebXR Three.js -----
    let renderer, scene, camera, xrSession, referenceSpace, hitTestSource, reticle;

    const container = document.getElementById('container');
    const arButton = document.getElementById('ar-button');
    const exitBtn = document.getElementById('exitBtn');

    function initThree(){
      renderer = new THREE.WebGLRenderer({alpha:true,antialias:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.xr.enabled = true;
      container.appendChild(renderer.domElement);

      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera();

      const light = new THREE.HemisphereLight(0xffffff,0x8888ff,1);
      scene.add(light);

      // reticle (hanya untuk hit-test, invisible)
      const geo = new THREE.PlaneGeometry(0.6,0.75); // rasio 4:5
      const mat = new THREE.MeshBasicMaterial({visible:false});
      reticle = new THREE.Mesh(geo,mat);
      reticle.matrixAutoUpdate=false;
      reticle.visible=false;
      scene.add(reticle);

      window.addEventListener('resize',()=>{
        renderer.setSize(window.innerWidth,window.innerHeight);
      });
    }

    function makePosterMesh(){
      // --- pakai gambar dari URL (placement awal) ---
      const texLoader = new THREE.TextureLoader();
      const tex = texLoader.load("https://xppfmghrhhrejnopnyir.supabase.co/storage/v1/object/public/ewan/WhatsApp%20Image%202025-08-18%20at%2018.14.03.jpeg");

      const geometry = new THREE.PlaneGeometry(0.6,0.75); // rasio 4:5
      const material = new THREE.MeshBasicMaterial({
        map:tex,
        side:THREE.DoubleSide,
        transparent:true,
        opacity:0.95
      });

      const mesh = new THREE.Mesh(geometry,material);

      // Glow neon frame
      const glowGeo = new THREE.PlaneGeometry(0.62,0.77);
      const glowMat = new THREE.MeshBasicMaterial({
        color:0x00eaff,transparent:true,opacity:0.25,side:THREE.DoubleSide
      });
      const glow = new THREE.Mesh(glowGeo,glowMat);
      mesh.add(glow);

      // Area tombol nomor 1â€“5 (invisible planes)
      for(let i=0;i<infos.length;i++){
        const btnGeo = new THREE.PlaneGeometry(0.55,0.1);
        const btnMat = new THREE.MeshBasicMaterial({transparent:true,opacity:0});
        const btn = new THREE.Mesh(btnGeo,btnMat);
        btn.position.set(0,0.25-i*0.15,0.01); // posisikan vertikal
        btn.userData.index=i;
        mesh.add(btn);
      }

      return mesh;
    }

    async function startXR(){
      if(!navigator.xr){alert("WebXR tidak tersedia");return;}
      try{
        xrSession = await navigator.xr.requestSession('immersive-ar',{requiredFeatures:['hit-test','local-floor']});
      }catch(e){alert("Gagal mulai AR: "+e.message);return;}

      initThree();
      renderer.xr.setSession(xrSession);

      referenceSpace = await xrSession.requestReferenceSpace('local');
      const viewerSpace = await xrSession.requestReferenceSpace('viewer');
      hitTestSource = await xrSession.requestHitTestSource({space:viewerSpace});

      xrSession.addEventListener('end', onSessionEnded);

      xrSession.addEventListener('select',()=>{
        if(reticle.visible){
          const poster = makePosterMesh();
          poster.position.setFromMatrixPosition(reticle.matrix);
          scene.add(poster);
        }
      });

      const onXRFrame = (time,frame)=>{
        xrSession.requestAnimationFrame(onXRFrame);
        const pose = frame.getViewerPose(referenceSpace);
        if(pose){
          const hits = frame.getHitTestResults(hitTestSource);
          if(hits.length>0){
            const hit=hits[0];
            const hitPose=hit.getPose(referenceSpace);
            reticle.visible=true;
            reticle.matrix.fromArray(hitPose.transform.matrix);
          }else{reticle.visible=false;}
        }
        renderer.render(scene,camera);
      };
      xrSession.requestAnimationFrame(onXRFrame);

      arButton.style.display='none';
      exitBtn.style.display='block';
    }

    function onSessionEnded(){
      if(renderer&&renderer.domElement){container.removeChild(renderer.domElement);}
      xrSession=null;
      arButton.style.display='block';
      exitBtn.style.display='none';
    }

    arButton.addEventListener('click',()=>{startXR();});
    exitBtn.addEventListener('click',()=>{if(xrSession)xrSession.end();});

    // -------- Clickable popup (raycaster untuk nomor) --------
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    container.addEventListener('click',(e)=>{
      if(!renderer)return;
      const posterMeshes = [];
      scene.traverse(o=>{if(o.type==="Mesh" && o.userData.index!==undefined){posterMeshes.push(o)}});
      if(posterMeshes.length===0)return;
      // hit-test ray
      const rect=renderer.domElement.getBoundingClientRect();
      mouse.x=( (e.clientX-rect.left)/rect.width )*2-1;
      mouse.y=-( (e.clientY-rect.top)/rect.height )*2+1;
      raycaster.setFromCamera(mouse,renderer.xr.getCamera(camera));
      const intersects=raycaster.intersectObjects(posterMeshes,true);
      if(intersects.length>0){
        const idx=intersects[0].object.userData.index;
        showPopup(idx);
      }
    });

    function showPopup(idx){
      const popup=document.getElementById('popup');
      const img=document.getElementById('popupImg');
      img.src=infos[idx].img;
      popup.style.display='flex';
      popup.onclick=()=>{popup.style.display='none';};
    }
  </script>
</body>
</html>
